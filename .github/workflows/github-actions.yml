name: Deployment

on:
  workflow_dispatch:
    inputs:
      release:
        description: 'Please provide the release version'
        required: true

jobs:
  deploy:
    env:
      POD_KUBECONFIG: '${{ github.workspace }}/.kube/pod-kubeconfig'
    name: Deployment
    runs-on: [self-hosted, kube-deploy] 

    steps:
       #- name: Checkout code
       #  uses: actions/checkout@v3

       #- name: Set up Kubectl
       #  uses: azure/k8s-set-context@v1
       #  with:
       #    kubeconfig: ${{ secrets.KUBECONFIG }}

       #- name: Verify Kubernetes Connection
       #  run: kubectl cluster-info

       - name: checkout
         run: |
           pwd
           ls -ltr
       - name: List Pods
         run: kubectl version
         
       - name: Configure AWS credentials
         uses: aws-actions/configure-aws-credentials@v3
         with:
           aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
           aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
           aws-region: us-east-2

       - name: Authenticate with EKS
         run: aws eks update-kubeconfig --name naapdev --region us-east-2

       - name: Deploy to EKS
         run: |
           kubectl get pod
